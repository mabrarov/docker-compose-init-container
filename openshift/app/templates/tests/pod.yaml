apiVersion: "v1"
kind: "Pod"
metadata:
  name: {{ include "app.test.podName" . | quote }}
  labels:
    {{- include "app.labels" . | nindent 4 }}
    {{- include "app.test.componentLabels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": "test"
spec:
  {{- if .Values.test.image.pull.secret }}
  imagePullSecrets:
    - name: {{ include "app.test.imagePullSecretName" . | quote }}
  {{- end }}
  containers:
    - name: {{ .Values.test.containerName | quote }}
      image: {{ include "app.test.imageFullName" . | quote }}
      imagePullPolicy: {{ .Values.test.image.pull.policy | quote }}
      command:
      - "curl"
      args:
        - "-s"
        - "--cacert"
        - {{ include "app.serviceCaCertifciateMountPath" . | quote }}
        - {{ (printf "%s://%s.%s.svc:%d" (include "app.portScheme" . | lower) (include "app.serviceName" .) .Release.Namespace (.Values.service.port | int)) | quote }}
  restartPolicy: "Never"
