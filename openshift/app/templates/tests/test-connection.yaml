apiVersion: "v1"
kind: "Pod"
metadata:
  name: {{ include "app.testPodName" . | quote }}
  labels:
    {{- include "app.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": "test"
spec:
  {{- with .Values.imagePullSecrets }}
  imagePullSecrets:
    {{- toYaml . | nindent 4 }}
  {{- end }}
  containers:
    - name: {{ .Values.container.test.name | quote }}
      image: {{ (print "%s:%s" .Values.container.test.image.repository (.Values.container.test.image.tag | default .Chart.AppVersion)) | quote }}
      imagePullPolicy: {{ .Values.imagePullPolicy | quote }}
      command:
      - "curl"
      args:
        - "-s"
        - "--cacert"
        - {{ include "app.serviceCaCertifciateMountPath" . | quote }}
        - {{ (printf "%s://%s.%s.svc:%s" (include "app.portScheme" . | lower) (include "app.serviceName" .) .Release.Namespace .Values.service.port) | quote }}
  restartPolicy: "Never"
